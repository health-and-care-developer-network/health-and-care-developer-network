<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Using Kerberos Integrated Authentication to Connect to SQL Server</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="687802dc-042a-4363-89aa-741685d165b3" /><meta name="Description" content="Beginning in Microsoft JDBC Driver 4.0 for SQL Server, an application can use the authenticationScheme connection property to indicate that it wants to connect to a database using type 4 Kerberos integrated authentication." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Using Kerberos Integrated Authentication to Connect to SQL Server</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>Beginning in Microsoft JDBC Driver 4.0 for SQL Server, an application can use the <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> connection property to indicate that it wants to connect to a database using type 4 Kerberos integrated authentication. See <span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">Setting the Connection Properties</a></span> for more information on connection properties. For more information on Kerberos, see <a href="http://go.microsoft.com/fwlink/?LinkId=101449">Kerberos Technical Supplement for Windows</a> and <a href="http://go.microsoft.com/fwlink/?LinkID=100758">Microsoft Kerberos</a>.</p><p>When using integrated authentication with the Java <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span>, you can configure the module using <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jaas/spec/com/sun/security/auth/module/Krb5LoginModule.html">Class Krb5LoginModule</a>.</p><p>The Microsoft JDBC Driver for SQL Server sets the following properties for IBM Java VMs:</p><ul><li><p><span sdata="langKeyword" value="useDefaultCcache = true"><span class="keyword">useDefaultCcache = true</span></span></p></li><li><p><span sdata="langKeyword" value="moduleBanner = false"><span class="keyword">moduleBanner = false</span></span></p></li></ul><p>The Microsoft JDBC Driver for SQL Server sets the following properties for all other Java VMs:</p><ul><li><p><span sdata="langKeyword" value="useTicketCache = true"><span class="keyword">useTicketCache = true</span></span></p></li><li><p><span sdata="langKeyword" value="doNotPrompt = true"><span class="keyword">doNotPrompt = true</span></span></p></li></ul></div><h1 class="heading">Remarks</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>Prior to Microsoft JDBC Driver 4.0 for SQL Server, applications could specify integrated authentication (using Kerberos or NTLM, depending on which is available) by using the <span sdata="langKeyword" value="integratedSecurity"><span class="keyword">integratedSecurity</span></span> connection property and by referencing <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, as described in <span sdata="link"><a href="44996746-d373-4f59-9863-a8a20bb8024a.htm">Building the Connection URL</a></span>.</p><p>Beginning in Microsoft JDBC Driver 4.0 for SQL Server, an application can use the <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> connection property to indicate that it wants to connect to a database using Kerberos integrated authentication using the pure Java Kerberos implementation:</p><ul><li><p>If you want integrated authentication using <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span>, you must still specify the <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> connection property. You would then also specify the <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> connection property.</p></li><li><p>To continue using integrated authentication with <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span>, just specify <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> connection property (and optionally <span sdata="langKeyword" value="authenticationScheme=NativeAuthentication"><span class="keyword">authenticationScheme=NativeAuthentication</span></span>).</p></li><li><p>If you specify <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> but do not also specify <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>, the driver will ignore the <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> connection property and it will expect to find user name and password credentials in the connection string.</p></li></ul><p>When using a datasource to create connections, you can programmatically set the authentication scheme using <a href="b942f78e-7ce1-44ef-923d-a7c3d7c76b83.htm">setAuthenticationScheme</a>.</p><p>A new logger has been added to support Kerberos authentication: com.microsoft.sqlserver.jdbc.internals.KerbAuthentication. For more information, see <span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">Tracing Driver Operation</a></span>.</p><p>The following guidelines will help you to configure Kerberos:</p><ol><li><p>Set <span sdata="langKeyword" value="AllowTgtSessionKey"><span class="keyword">AllowTgtSessionKey</span></span> to 1 in the registry for Windows. For more information, see <a href="http://support.microsoft.com/kb/837361">Kerberos protocol registry entries and KDC configuration keys in Windows Server 2003</a>.</p></li><li><p>Make sure that the Kerberos configuration (krb5.conf in UNIX environments), points to the correct realm and KDC for your environment.</p></li><li><p>Initialize the TGT cache by using kinit or logging into the domain.</p></li><li><p>When an application that uses <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> runs on the Windows Vista or Windows 7 operating systems, you should use a standard user account. However if you run the application under an administrator’s account, the application must run with administrator privileges.</p></li></ol></div><h1 class="heading">Service Principal Names</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>A service principal name (SPN) is the name by which a client uniquely identifies an instance of a service. For more information about service principal names (SPNs), see:</p><ul><li><p><a href="http://support.microsoft.com/kb/319723">How to use Kerberos authentication in SQL Server</a></p></li><li><p><a href="http://go.microsoft.com/fwlink/?LinkId=207814">Using Kerberos with SQL Server</a></p></li></ul></div><h1 class="heading">Creating a Login Module Configuration File</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>You can optionally specify a Kerberos configuration file. If a configuration file is not specified, the following settings are in effect:</p><dl class="authored"><dt>Sun JVM</dt><dd><p>com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;</p></dd><dt>IBM JVM</dt><dd><p>com.ibm.security.auth.module.Krb5LoginModule required useDefaultCcache = true moduleBanner = false;</p></dd></dl><p>If you decide to create a login module configuration file, the file must follow this format:</p><div class="sampleCode"><span codeLanguage="other"><pre>&lt;<i>name</i>&gt; {
    &lt;<i>LoginModule</i>&gt; &lt;<i>flag</i>&gt; &lt;<i>LoginModule options</i>&gt;;
    &lt;<i>optional_additional_LoginModules</i>, <i>flags_and_options</i>&gt;;
};</pre></span></div><p>A login configuration file consists of one or more entries, each specifying which underlying authentication technology should be used for a particular application or applications. For example,</p><div class="sampleCode"><span codeLanguage="other"><pre>SQLJDBCDriver {
   com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;
};</pre></span></div><p>So, each login module configuration file entry consists of a name followed by one or more LoginModule-specific entries, where each LoginModule-specific entry is terminated by a semicolon and the entire group of LoginModule-specific entries is enclosed in braces. Each configuration file entry is terminated by a semicolon.</p><p>In addition to allowing the driver to acquire Kerberos credentials using the settings specified in the login module configuration file, the driver can use existing credentials. This can be useful when your application needs to create connections using more than one user’s credentials.</p><p>The driver will attempt to use existing credentials if they are available, before attempting to login using the specified login module. Thus, when using the Subject.doAs method for executing code under a specific context, a connection will be created with the credentials passed to the Subject.doAs call.</p><p>For more information, see <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">JAAS Login Configuration File</a> and <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jgss/tutorials/KerberosReq.html">Class Krb5LoginModule</a>.</p></div><h1 class="heading">Creating a Kerberos Configuration File</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>For more information about Kerberos configuration files, see <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">Kerberos Requirements</a>.</p><p>This is a sample domain configuration file, where YYYY and ZZZZ are domain names at your site.</p><div class="sampleCode"><span codeLanguage="other"><pre>[libdefaults]
default_realm = YYYY.CORP.CONTOSO.COM
dns_lookup_realm = false
dns_lookup_kdc = true
ticket_lifetime = 24h
forwardable = yes

[domain_realm]
.yyyy.corp.contoso.com = YYYY.CORP.CONTOSO.COM
.zzzz.corp.contoso.com = ZZZZ.CORP.CONTOSO.COM

[realms]
        YYYY.CORP.CONTOSO.COM = {
  kdc = krbtgt/YYYY.CORP. CONTOSO.COM @ YYYY.CORP. CONTOSO.COM
  default_domain = YYYY.CORP. CONTOSO.COM
}

        ZZZZ.CORP. CONTOSO.COM = {
  kdc = krbtgt/ZZZZ.CORP. CONTOSO.COM @ ZZZZ.CORP. CONTOSO.COM
  default_domain = ZZZZ.CORP. CONTOSO.COM
}
</pre></span></div></div><h1 class="heading">Enabling the Domain Configuration File and the Login Module Configuration File</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>You can enable a domain configuration file with -Djava.security.krb5.conf. You can enable a login module configuration file with <span sdata="langKeyword" value="-Djava.security.auth.login.config"><span class="keyword">-Djava.security.auth.login.config</span></span>.</p><p>For example, when you start your application, you could use this command line:</p><div class="sampleCode"><span codeLanguage="other"><pre>Java.exe -Djava.security.auth.login.config=SQLJDBCDriver.conf -Djava.security.krb5.conf=krb5.ini &lt;<i>APPLICATION_NAME</i>&gt;
</pre></span></div></div><h1 class="heading">Verifying that SQL Server Can be Accessed via Kerberos</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>Run the following query in SQL Server Management Studio:</p><p><span sdata="langKeyword" value="select auth_scheme from sys.dm_exec_connections where session_id=@@spid"><span class="keyword">select auth_scheme from sys.dm_exec_connections where session_id=@@spid</span></span></p><p>Make sure that you have the necessary permission to run this query.</p></div><span id="seeAlsoSpan"><h1 class="heading">See Also</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">Connecting to SQL Server with the JDBC Driver</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Send <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','01.00.12024.10000','%0\dThank%20you%20for%20your%20feedback.%20The%20developer%20writing%20teams%20use%20your%20feedback%20to%20improve%20documentation.%20While%20we%20are%20reviewing%20your%20feedback,%20we%20may%20send%20you%20e-mail%20to%20ask%20for%20clarification%20or%20feedback%20on%20a%20solution.%20We%20do%20not%20use%20your%20e-mail%20address%20for%20any%20other%20purpose%20and%20we%20delete%20it%20after%20we%20finish%20our%20review.%0\AFor%20further%20information%20about%20the%20privacy%20policies%20of%20Microsoft,%20please%20see%20http://privacy.microsoft.com/en-us/default.aspx.%0\A%0\d','Customer%20Feedback');">feedback</a> on this topic to Microsoft.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.  All rights reserved.</a></p></span></div></div></body></html>
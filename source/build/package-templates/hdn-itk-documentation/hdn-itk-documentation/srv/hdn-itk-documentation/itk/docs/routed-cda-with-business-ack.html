<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Apr 2, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Nick Jones" />
    <meta name="Date-Revision-yyyymmdd" content="20130402" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ITK API and Reference Implementation - 
    ITK API and reference implementation</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<link rel="stylesheet" href="css/itk-mini-site.css"></link>
                      
        
<link rel="stylesheet" type="text/css" href="js/prettify.css"></link>
                      
        
<script src="js/prettify.js" type="text/javascript"></script>
                      
        
<script src="js/itk-api-site.js" type="text/javascript"></script>
          
            </head>
        <body class="topBarEnabled">
          
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                                  <div class="container"><div class="nav-collapse">
            
                
                                                                                <a class="brand" href="index.html"  title="IRK">

                                
                                                                                                                    <img src="images/itk-small.gif" alt="IRK" />
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Scenarios <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="scenarios-overview.html"  title="Scenarios Overview">Scenarios Overview</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="scenarios-overview.html#Synchronous"  title="Synchronous">Synchronous</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="sync-query-sender.html"  title="Spine Mini-Services (client)">Spine Mini-Services (client)</a>
</li>
                                  <li>      <a href="sync-query-receiver.html"  title="Spine Mini-Services (provider)">Spine Mini-Services (provider)</a>
</li>
                                  <li>      <a href="simple-sync-fireandforget.html"  title="ADT Admit Patient (P/H)">ADT Admit Patient (P/H)</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="scenarios-overview.html#Simple Asynchronous"  title="Simple Asynchronous">Simple Asynchronous</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="simple-async-adt-query.html"  title="ADT Query patient (XML)">ADT Query patient (XML)</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="scenarios-overview.html#Routed Message"  title="Routed Message">Routed Message</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="routed-cda-document-repo.html"  title="Routed CDA (document repository)">Routed CDA (document repository)</a>
</li>
                                  <li>      <a href="routed-cda-with-business-ack.html"  title="Routed CDA (with business Ack)">Routed CDA (with business Ack)</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Reports <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="index.html"  title="About">About</a>
</li>
                                  <li>      <a href="team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="modules.html"  title="Project Modules">Project Modules</a>
</li>
                                  <li>      <a href="license.html"  title="Project License">Project License</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="xref/index.html"  title="Source Xref">Source Xref</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../itk-api/index.html"  title="ITK API">ITK API</a>
</li>
                  
                      <li>      <a href="../itk-ri/index.html"  title="ITK Java Reference Implementation">ITK Java Reference Implementation</a>
</li>
                  
                      <li>      <a href="../itk-samples/index.html"  title="ITK Samples project">ITK Samples project</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="requirements-cross-ref.html"  title="ITK Requirement traceability">ITK Requirement traceability</a>
</li>
                  
                      <li>      <a href="../itk-api/apidocs/index.html"  title="Javadocs (API only)">Javadocs (API only)</a>
</li>
                  
                      <li>      <a href="apidocs/index.html"  title="Javadocs (API + RI + Samples)">Javadocs (API + RI + Samples)</a>
</li>
                  
                      <li>      <a href="xref/index.html"  title="Java source cross-reference">Java source cross-reference</a>
</li>
                  
                      <li>      <a href="../itk-samples/downloads.html"  title="Downloads">Downloads</a>
</li>
                  
                      <li>      <a href="../itk-samples/index.html"  title="Install Guide">Install Guide</a>
</li>
                  
                      <li>      <a href="docs/ITK Basic Workshop v0.1 - Webex.pdf"  target="_blank" title="ITK Basic Workshop - Webex Slides">ITK Basic Workshop - Webex Slides</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Disclaimer <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="disclaimer.html"  title="Disclaimer">Disclaimer</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
                                                              
                               <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
                      <li>      <a href="http://services.developer.nhs.uk/itk-samples/"  title="ITK RI (Running samples)">ITK RI (Running samples)</a>
</li>
      <li>      <a href="http://www.connectingforhealth.nhs.uk/systemsandservices/interop"  title="CFH ITK home page">CFH ITK home page</a>
</li>
      <li>      <a href="http://www.connectingforhealth.nhs.uk/systemsandservices/interop/fund"  title="ISCF">ISCF</a>
</li>
      <li>      <a href="http://www.uktcregistration.nss.cfh.nhs.uk/trud3/user/guest/group/0/pack/21"  title="ITK @ TRUD">ITK @ TRUD</a>
</li>
      <li>      <a href="http://www.networks.nhs.uk/nhs-networks/interoperability-toolkit-itk"  title="ITK @ NHS Networks">ITK @ NHS Networks</a>
</li>
      <li>      <a href="http://www.linkedin.com/groups/NHS-Interoperability-Toolkit-3831338"  title="ITK @ LinkedIn">ITK @ LinkedIn</a>
</li>
                  </ul>
              </li>
            </ul>
          
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>ITK API and Reference Implementation mini-site</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
            
                
                    
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            
 
  
  <div id="container">
    <div id="bodyColumn">
      <div class="section">
        <div class="section"><h2>Routed CDA Document - Business Acknowledgement Example<a name="Routed_CDA_Document_-_Business_Acknowledgement_Example"></a></h2>
        <ul class="nav nav-tabs tab-control">
		  <li class="active"><a href="#overview">Overview</a></li>
		  <li><a href="#sender">Sender</a></li>
		  <li><a href="#router">ITK Router</a></li>
		  <li><a href="#receiver">Receiver</a></li>
		  <li><a href="#request">Request</a></li>
		  <li><a href="#response">Response</a></li>
		</ul>
     </div>
     </div>

<div class="row-fluid" style="height:450px">
    <div class="span5">
      <p class="tab-title">Black Box View</p>
   
       <div class="clickablemapview">
            <img src="images/routed message.jpg" alt="overview of the routed message pattern (with business ack)" />
	        <map name="bbviewmap" id="bbviewmap">
		       <area shape="rect" coords="25,35,112,84" alt="" title="Sender" href="#sender" />
		       <area shape="rect" coords="346,35,433,84" alt="" title="Receiver" href="#receiver" />
	       </map>
        </div>    
    </div>
    <div class="span7">
        <div class="tab-content">
  <div class="tab-pane active" id="overview">
        <p class="tab-title">Overview</p>
         <p>This scenario illustrates the case where the sender elects to receive a business acknowledgement. In this case the ITK API allows
         the setting of a message property to request the return of a Business Acknowledgement. </p>
         <p>It is important to note that the Business Acknowledgement is a Routed messages and therefore requires an Infrastructure Acknowledgement 
         itself, making this is the most complex of the ITK message patterns.</p>
  </div>

  <div class="tab-pane" id="sender">
        <p class="tab-title">Sender View</p>
        <p>
        From the Sender perspective this is very similar to the previous CDA scenario, except that the sender requests a Business Acknowledgement. </p>
        <p>The sending application must also provide the capability to receive and acknowledge the Business Acknowledgement.</p>
  </div>

  <div class="tab-pane" id="router">
        <p class="tab-title">ITK Router View</p>
        <p>
        The ITK Router is not affected by the request for a Business Acknowledgement. This is simply forwarded as an attribute of the message.</p>
  </div>

  <div class="tab-pane" id="receiver">
        <p class="tab-title">Receiver View</p>
        <p>
        The Receiver at the infrastructure level - essentially within the Reference Implementation - is not affected by the request for a 
        Business Acknowledgement. This is an application responsibility and must be handled by the application code.</p>
        <p>The application will construct the Business Acknowledgement (according to the schema in the ITK Core Pack) and send back to the 
        originator ITK address using the standard <tt>sendAsync</tt> method of the API.</p>
        <p>It is important to note that because the </p>
  </div>
  <div class="tab-pane" id="request">
      <p class="tab-title">Request Message
      <a href="samples/CDA_BA_01.xml" target="_blank" type="text/xml">(Get example)</a></p>
		<p>The Business Acknowledgement is requested in the handling specification section.</p>
		<div class="source">
			<div><pre class="prettyprint">
&lt;itk:header
  service=&quot;urn:nhs-itk:services:201005:SendCDADocument-v2-0&quot; trackingid=&quot;A40BF902-AEDE-4ABC-94A1-2623C9D3E357&quot;&gt;
  &lt;itk:addresslist&gt;
    &lt;itk:address uri=&quot;urn:nhs-uk:addressing:ods:TESTORGS:CDAEMULATORLOCAL&quot;/&gt;
  &lt;/itk:addresslist&gt;
  &lt;itk:auditIdentity&gt;
    &lt;itk:id uri=&quot;urn:nhs-uk:identity:ods:R59:oncology&quot;/&gt;
  &lt;/itk:auditIdentity&gt;
  &lt;itk:manifest count=&quot;1&quot;&gt;
    &lt;itk:manifestitem id=&quot;uuid_NJ3&quot; mimetype=&quot;text/xml&quot; 
         profileid=&quot;urn:nhs-en:profile:nonCodedCDADocument-v2-0&quot;/&gt;
  &lt;/itk:manifest&gt;
  &lt;itk:senderAddress uri=&quot;urn:nhs-uk:addressing:ods:R59:oncology&quot;/&gt;
  &lt;itk:handlingSpecification&gt;
    &lt;itk:spec key=&quot;urn:nhs:itk:ns:201005:ackrequested&quot; value=&quot;true&quot;/&gt;
  &lt;/itk:handlingSpecification&gt;
&lt;/itk:header&gt;</pre></div>
		</div>
  </div>
  <div class="tab-pane" id="response">
      <p class="tab-title">Response Message
      <a href="samples/BusAck_01.xml" target="_blank" type="text/xml">(Get example)</a></p>
		<p>The Business Acknowledgement is a Core Message contained within the Distribution Envelope.</p>
		<div class="source">
			<div><pre class="prettyprint">
&lt;itk:DistributionEnvelope xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
  &lt;itk:header service=&quot;urn:nhs-itk:services:201005:SendBusinessAck-v1-0&quot; trackingid=&quot;2A966984-4  ...
    &lt;itk:addresslist&gt; ... &lt;/itk:addresslist&gt;
    &lt;itk:auditIdentity&gt; ...  &lt;/itk:auditIdentity&gt;
    &lt;itk:manifest count=&quot;1&quot;&gt; 
      &lt;itk:manifestitem id=&quot;uuid_CDE4A7DB-979B-4D15-A7F3-53F247B4BAA7&quot;
	mimetype=&quot;text/xml&quot; profileid=&quot;urn:nhs-en:profile:ITKBusinessAcknowledgement-v1-0&quot;/&gt;
    &lt;/itk:manifest&gt;
    &lt;itk:senderAddress uri=&quot;urn:nhs-uk:addressing:ods:TESTORGS:ORGA&quot;/&gt;
  &lt;/itk:header&gt;
    &lt;itk:payloads count=&quot;1&quot;&gt;
      &lt;itk:payload id=&quot;uuid_CDE4A7DB-979B-4D15-A7F3-53F247B4BAA7&quot;&gt;
        &lt;v3:BusinessResponseMessage xmlns:v3=&quot;urn:hl7-org:v3&quot;&gt;
          &lt;v3:id root=&quot;CDE4A7DB-979B-4D15-A7F3-53F247B4BAA7&quot;/&gt;
          &lt;v3:creationTime value=&quot;201302051101&quot;/&gt;
          &lt;v3:interactionId extension=&quot;urn:nhs-itk:interaction:ITKBusinessAcknowledgement-v1-0&quot; 
          root=&quot;2.16.840.1.113883.2.1.3.2.4.12&quot;/&gt;</pre></div>
		</div>
      
  </div>
</div>
    </div>
</div>
   <div id="bodyColumn3">
          <div class="section">
               <div class="section"><h2>How it all happens....<a name="How_it_all_happens...."></a></h2>
	        <ul class="nav nav-tabs tab-control">
			  <li class="active"><a href="#step1" class="itk-application">Step 1<br />(Sender App)</a></li>
			  <li><a href="#step2" class="itk-receiver">Step 2<br />(Sender)</a></li>
			  <li><a href="#step3" class="itk-application">Step 3<br />(Rcv App)</a></li>
			</ul>
          </div>
    </div>

       <div class="tab-content">
<div class="row-fluid tab-pane active" id="step1">
	<div class="span5"><p></p>
	    <p><span class="label itk-label-application label-large">Step 1</span>
	       <span class="tab-title">(Sending Application)</span>
	    </p>

		<p>The sending application builds a <tt>SimpleMessage</tt> and populates the business payload with the CDA Document in serialized form.
		The application requests a business acknowledgement by adding a handling specification into the message properties.
		</p>
		<p>The full <a href="xref/uk/nhs/interoperability/client/samples/cda/HelloWorldCDASourceServlet.html#88">source code for the Hello World CDA example can be seen here</a>.</p>
		
	</div>

	<div class="span7">
		<div class="source">
			<div><pre class="prettyprint">
 // Create the message
 ITKMessage msg = new SimpleMessage();
 msg.setBusinessPayload(docText);
 ...
 // Set the message properties
 mp.setServiceId(&quot;urn:nhs-itk:services:201005:SendCDADocument-v2-0&quot;);
 ...
 // Request the business ack.
 if (businessAckRequired.equalsIgnoreCase(&quot;Y&quot;)){
   mp.addHandlingSpecification(ITKMessageProperties.BUSINESS_ACK_HANDLING_SPECIFICATION_KEY, &quot;true&quot;);
 }
 
 // Create the sender
 ITKMessageSender sender = new ITKMessageSenderImpl();
 ...
 // Send this message Asynchronously - return is void.
 sender.sendAsync(msg);</pre></div>
		</div>

	</div>

</div>
<div class="row-fluid tab-pane" id="step2">
	<div class="span5"><p></p>
	    <p><span class="label itk-label-receiver label-large">Step 2</span>
	       <span class="tab-title">(Sending R.I.)</span>
	    </p>
		<p>The <tt>sendAsync</tt> API builds handling specifictions into the Distribution Envelope on the wire as shown in this example..</p>
	</div>
	<div class="span7">

		<div class="source">
			<div><pre class="prettyprint">
&lt;itk:header
  service=&quot;urn:nhs-itk:services:201005:SendCDADocument-v2-0&quot; trackingid=&quot;A40BF902-AEDE-4ABC-94A1-2623C9D3E357&quot;&gt;
  &lt;itk:addresslist&gt;
    &lt;itk:address uri=&quot;urn:nhs-uk:addressing:ods:TESTORGS:CDAEMULATORLOCAL&quot;/&gt;
  &lt;/itk:addresslist&gt;
  &lt;itk:auditIdentity&gt;
    &lt;itk:id uri=&quot;urn:nhs-uk:identity:ods:R59:oncology&quot;/&gt;
  &lt;/itk:auditIdentity&gt;
  &lt;itk:manifest count=&quot;1&quot;&gt;
    &lt;itk:manifestitem id=&quot;uuid_NJ3&quot; mimetype=&quot;text/xml&quot; 
         profileid=&quot;urn:nhs-en:profile:nonCodedCDADocument-v2-0&quot;/&gt;
  &lt;/itk:manifest&gt;
  &lt;itk:senderAddress uri=&quot;urn:nhs-uk:addressing:ods:R59:oncology&quot;/&gt;
  &lt;itk:handlingSpecification&gt;
    &lt;itk:spec key=&quot;urn:nhs:itk:ns:201005:ackrequested&quot; value=&quot;true&quot;/&gt;
  &lt;/itk:handlingSpecification&gt;
&lt;/itk:header&gt;</pre></div>
		</div>
	</div>


</div>
<div class="row-fluid tab-pane" id="step3">
	<div class="span5"><p></p>
	    <p><span class="label itk-label-sender label-large">Step 3</span>
	       <span class="tab-title">(Receiver App)</span>
	    </p>
		<p>The message properties, including the handling specifications, are deserialized by the Reference Implementation and presented back
		to the receiving application handler as they were built by the sender.</p>
		<p>Where the Business Ack handling specification is present then the application handler knows that it must return a business acknowledgement.</p>
		<p>When this happens will depend on the business process of the receiver and the agreement between sender and receiver as the business 
		acknowledgement is a generic wrap designed to contain content as agreed locally.
		</p>
		
	</div>
	<div class="span7">

		<div class="source">
		</div>

	</div>

</div>

</div>

</div>


                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
              <div class="row span12">All content is available under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/" title="Open Government Licence">Open Government Licence</a>, except where otherwise stated<br/>
                                  All example source code is available under <a href="http://www.apache.org/licenses/LICENSE-2.0.html" title="Apache 2.0 License">Apache 2.0</a>, except where otherwise stated      
                    
                  <li id="publishDate" class="pull-right">Last Published: 2013-04-02</li> 
              <li id="projectVersion" class="pull-right">Version: 0.1-SNAPSHOT</li>
            </div>

        
                <p id="poweredBy" class="pull-right">
                                                                                                                      <a href="http://www.connectingforhealth.nhs.uk/systemsandservices/interop" title="ITK" class="builtBy">
        <img class="builtBy"  alt="ITK" src="images/itk-logo-2.png"    />
      </a>
                  </p>
        
                </div>
    </footer>
  </body>
</html>
